#!/usr/bin/env bash
# Script to configure Nginx with a custom X-Served-By HTTP header

# Update package lists
sudo apt-get update

# Install Nginx if not already installed
sudo apt-get install -y nginx

# Create a backup of the original Nginx configuration
sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak

# Get the hostname of the server
SERVER_HOSTNAME=$(hostname)

# Modify the Nginx configuration to add the custom header
sudo sed -i "/server_name _;/a \        add_header X-Served-By $SERVER_HOSTNAME;" /etc/nginx/sites-available/default

# Test Nginx configuration
sudo nginx -t

# If configuration test passes, restart Nginx
if [ $? -eq 0 ]; then
    sudo service nginx restart
    echo "Nginx configured with custom X-Served-By header: $SERVER_HOSTNAME"
else
    echo "Nginx configuration test failed. Please check the configuration."
    exit 1
fi
